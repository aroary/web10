{"version":3,"file":"wapi.js","sources":["../../src/wapiAuth.js","../../src/wapi.js"],"sourcesContent":["import axios from 'axios';\r\n\r\n//initializes the sdk for web10 authenticators.\r\nconst wapiAuthInit = function(wapi) {\r\n  const wapiAuth = {};\r\n\r\n  //mints a second level token for the referrer site.\r\n  wapiAuth.mintOAuthToken = function () {\r\n    const referrerURL = new URL(document.referrer);\r\n    wapi\r\n      .getTieredToken(referrerURL.hostname, wapi.readToken().provider)\r\n      .then(function (response) {\r\n        wapiAuth.oAuthToken = response.data.token;\r\n      })\r\n  };\r\n\r\n  //initialize the oauth token\r\n  wapi.isSignedIn() && document.referrer ? wapiAuth.mintOAuthToken() : (wapiAuth.oAuthToken = null);\r\n\r\n  //send the apikey back to the oauth requesting site\r\n  wapiAuth.sendToken = function () {\r\n    window.opener.postMessage(\r\n      {\r\n        type: \"auth\",\r\n        token: wapiAuth.oAuthToken,\r\n      },\r\n      \"*\"\r\n    );\r\n    window.close();\r\n  };\r\n\r\n  //log into an existing web10 account\r\n  //get tokens for web10 auth, and a parent oauth application.\r\n  wapiAuth.logIn = function (provider, username, password, setAuth, setStatus) {\r\n    //web10 auth login\r\n    axios\r\n      .post(`${wapi.defaultAPIProtocol}//${provider}/web10token`, {\r\n        username: username,\r\n        password: password,\r\n        token: null,\r\n        site: window.location.hostname,\r\n        target: null,\r\n      })\r\n      .then(function (response) {\r\n        wapi.setToken(response.data.token);\r\n        setAuth(true);\r\n        wapiAuth.mintOAuthToken();\r\n      })\r\n      .catch((error) => setStatus(`Log in failed : ${error.response.data.detail}`));\r\n  };\r\n\r\n  //sign up for a new web10 account\r\n  wapiAuth.signUp = function (provider, username, password, betacode, phone) {\r\n    return axios\r\n      .post(`${wapi.defaultAPIProtocol}//${provider}/signup`, {\r\n        username: username,\r\n        password: password,\r\n        betacode:betacode,\r\n        phone: phone,\r\n      })\r\n  };\r\n\r\n  //If there is a referrer, listen for the SMR and use it to set a web10 auth app state\r\n  wapiAuth.SMRListen = function (setState) {\r\n    if (window.opener) {\r\n      window.addEventListener(\"message\", function (e) {\r\n        if (e.data.type === \"smr\") setState(e.data);\r\n      });\r\n      //Notify SMR requester that the auth app is ready.\r\n      window.opener.postMessage(\r\n        {\r\n          type: \"SMRListen\",\r\n        },\r\n        \"*\"\r\n      );\r\n    }\r\n  };\r\n\r\n  const api = ()=> `${wapi.defaultAPIProtocol}//${wapi.readToken()[\"provider\"]}`;\r\n\r\n\r\n  //change functionality\r\n  wapiAuth.changePass = function(pass,newPass){\r\n    return axios.post(`${api()}/change_pass`,{username:wapi.readToken()[\"username\"],password:pass,new_pass:newPass})\r\n  }\r\n\r\n  wapiAuth.changePhone= function(pass,newPhone){\r\n    console.log(\"in : \",pass,newPhone)\r\n    return axios.post(`${api()}/change_phone`,{username:wapi.readToken()[\"username\"],password:pass,phone:newPhone})\r\n  }\r\n\r\n\r\n  //twilio functionality\r\n  wapiAuth.sendCode = function(){\r\n    return axios.post(`${api()}/send_code`,{token:wapi.token})\r\n  }\r\n  wapiAuth.verifyCode = function(code){\r\n    return axios.post(`${api()}/verify_code`,{token:wapi.token,query:{code:code}})\r\n  }\r\n\r\n  //stripe functionality\r\n  wapiAuth.manageSpace = function(){\r\n    return axios.post(`${api()}/manage_space`,{token:wapi.token})\r\n  }\r\n  wapiAuth.manageCredits = function(){\r\n    return axios.post(`${api()}/manage_credits`,{token:wapi.token})\r\n  }\r\n  wapiAuth.manageBusiness = function(){\r\n    return axios.post(`${api()}/manage_business`,{token:wapi.token})\r\n  }\r\n\r\n  wapiAuth.manageSubscriptions = function(){\r\n    return axios.post(`${api()}/manage_subscriptions`,{token:wapi.token})\r\n  }\r\n\r\n  wapiAuth.businessLogin = function(){\r\n    return axios.post(`${api()}/business_login`,{token:wapi.token})\r\n  }\r\n\r\n  wapiAuth.getPlan = function(){\r\n    return axios.post(`${api()}/get_plan`,{token:wapi.token})\r\n  }\r\n\r\n  //output the wapiAuth object\r\n  return wapiAuth;\r\n}\r\n\r\nexport {wapiAuthInit};","import axios from 'axios'\r\nimport { Peer } from \"peerjs\";\r\nimport {wapiAuthInit} from './wapiAuth'\r\n\r\n//helper function for loading relevant cookies on page load.\r\nfunction cookieDict() {\r\n  return window.document.cookie.split(\";\").reduce((res, c) => {\r\n    const [key, val] = c.trim().split(\"=\").map(decodeURIComponent);\r\n    try {\r\n      return Object.assign(res, { [key]: JSON.parse(val) });\r\n    } catch (e) {\r\n      return Object.assign(res, { [key]: val });\r\n    }\r\n  }, {});\r\n}\r\n\r\n//initializes the sdk for web10 apps.\r\nconst wapiInit = function(authUrl = \"https://auth.web10.app\", rtcOrigin = \"rtc.web10.app\", protocol = null) {\r\n  const wapi = {};\r\n\r\n  // get the default api protocol, which is required to match its auth portals protocol\r\n  wapi.defaultAPIProtocol = protocol ? protocol + \":\" : new URL(authUrl).protocol;\r\n\r\n  //wapi variables\r\n  wapi.childWindow = null;\r\n  wapi.token = cookieDict()[\"token\"];\r\n\r\n  /************ \r\n   *** AUTH ***\r\n   ************/\r\n\r\n  //sets the api key in wapi and stores it in cookies\r\n  wapi.setToken = function (token) {\r\n    wapi.token = token;\r\n    //set the cookie max age to 60 days (1 day padding from the true 61 day expiration)\r\n    const age = 3600 * 24 * 60;\r\n    document.cookie = `token=${wapi.token};Secure;path=/;max-age=${age};`;\r\n  };\r\n\r\n  //scrub the api keys from wapi and deletes it from cookies\r\n  wapi.scrubToken = function () {\r\n    document.cookie = \"token=;max-age=-1;path=/;\";\r\n    wapi.token = null;\r\n  };\r\n\r\n  //opens up a child window for auth stuff\r\n  wapi.openAuthPortal = () => wapi.childWindow = window.open(authUrl, \"_blank\");\r\n\r\n  //checks if wapi is currently signed in\r\n  wapi.isSignedIn = () => wapi.token != null;\r\n\r\n  //signs out wapi\r\n  wapi.signOut = () => wapi.scrubToken();\r\n\r\n  //listens for an oauth result from the child window\r\n  wapi.authListen = setAuth => window.addEventListener(\"message\", e => {\r\n    if (e.data.type === \"auth\") {\r\n      wapi.setToken(e.data.token || \"\");\r\n      if (setAuth != null) setAuth(wapi.isSignedIn());\r\n    }\r\n  });\r\n\r\n  wapi.readToken = () => !wapi.token ? null : JSON.parse(atob(wapi.token.split(\".\")[1]));\r\n\r\n  //get tiered tokens for strong web10 security\r\n  wapi.getTieredToken = (site, target, protocol = wapi.defaultAPIProtocol) => axios\r\n    .post(`${protocol}//${wapi.readToken().provider}/web10token`, {\r\n      username: wapi.readToken().username,\r\n      password: null,\r\n      token: wapi.token,\r\n      site,\r\n      target\r\n    });\r\n\r\n  /**************\r\n   **** CRUD ****\r\n   **************/\r\n\r\n  //patch instead of get so patch can have an HTTPS E2E encrypted body\r\n  wapi.read = (service, query = null, username = null, provider = null, protocol = wapi.defaultAPIProtocol) => wapi\r\n    ._W10CRUD(axios.patch, provider, username, service, query, null, protocol);\r\n  wapi.create = (service, query = null, username = null, provider = null, protocol = wapi.defaultAPIProtocol) => wapi\r\n    ._W10CRUD(axios.post, provider, username, service, query, null, protocol);\r\n  wapi.update = (service, query = null, update = null, username = null, provider = null, protocol = wapi.defaultAPIProtocol) => wapi\r\n    ._W10CRUD(axios.put, provider, username, service, query, update, protocol);\r\n  //axios delete is implemented differently\r\n  wapi.delete = (service, query = null, username = null, provider = null, protocol = wapi.defaultAPIProtocol) => wapi\r\n    ._W10CRUD((url, data) => axios.delete(url, { data: data }), provider, username, service, query, null, protocol);\r\n\r\n  wapi._W10CRUD = function (HTTPRequestFunction, provider, username, service, query, update, protocol) {\r\n    if ((!username && !wapi.token) || username === \"anon\") return console.error(\"cant CRUD anon accounts\");\r\n    if (!provider && !wapi.token) return console.error(\"web10 request without provider and token. need one.\");\r\n\r\n    provider = provider || wapi.readToken().provider;\r\n    username = username || wapi.readToken().username;\r\n    return HTTPRequestFunction(`${protocol}//${provider}/${username}/${service}`, { token: wapi.token, query, update });\r\n  };\r\n\r\n  //SMRs\r\n  wapi.SMROnReady = (sirs, scrs) => window\r\n    .addEventListener(\"message\", e => e.data[\"type\"] === \"SMRListen\" && wapi.childWindow.postMessage({ type: \"smr\", sirs, scrs }, \"*\"));\r\n  wapi.SMRResponseListen = setStatus => window\r\n    .addEventListener(\"message\", e => e.data.type === \"status\" && setStatus(e.data.status));\r\n\r\n  /*************\r\n   **** P2P ****\r\n   *************/\r\n\r\n  wapi.peer = null;\r\n\r\n  wapi.peerID = (provider, user, origin, label) => `${provider} ${user} ${origin} ${label}`.replaceAll(\".\", \"_\");\r\n\r\n  // initializes the peer and listens for inbound connections\r\n  wapi.inBound = {}\r\n  wapi.initP2P = function (onInbound = null, label = \"\", secure = true) {\r\n    const token = wapi.readToken();\r\n    var id = wapi.peerID(token.provider, token.username, token.site, label);\r\n    wapi.peer = new Peer(id, {\r\n      host: rtcOrigin,\r\n      secure: secure,\r\n      port: secure ? 443 : 80,\r\n      path: '/',\r\n      token: `${wapi.token}~${label}`,\r\n    });\r\n\r\n    if (onInbound) {\r\n      wapi.peer.on('connection', function (conn) {\r\n        wapi.inBound[conn.peer] = conn;\r\n        conn.on('data', (data) => onInbound(conn, data));\r\n        conn.on('close', () => delete wapi.inBound[conn.peer])\r\n      });\r\n    }\r\n  }\r\n\r\n  // makes outbound connection IF it doesnt already exist\r\n  // else returns the existing connection\r\n  wapi.outBound = {}\r\n\r\n  wapi.P2P = function (provider, username, origin, label) {\r\n    if (!wapi.peer) console.error(\"not initialized\")\r\n    const id = wapi.peerID(provider, username, origin, label)\r\n    var conn = null;\r\n    if (!wapi.outBound[id]) {\r\n      conn = wapi.peer.connect(id);\r\n      wapi.outBound[conn.peer] = conn;\r\n      conn.on('close', () => delete wapi.outBound[conn.peer])\r\n    } else conn = wapi.outBound[id]\r\n    return conn\r\n  }\r\n\r\n  wapi.send = function (provider, username, origin, label, data) {\r\n    const conn = wapi.P2P(provider, username, origin, label);\r\n    if (conn.open) {\r\n      conn.send(data);\r\n      return { connected: true };\r\n    }\r\n    else {\r\n      conn.on('open', () => conn.send(data))\r\n      return { connected: false };\r\n    }\r\n  }\r\n\r\n\r\n  /*************** \r\n   *** dev pay ***\r\n   ***************/\r\n\r\n  wapi.checkout = (seller, title, price, success_url, cancel_url) => axios\r\n    .post(`${wapi.defaultAPIProtocol}//${wapi.readToken().provider}/dev_pay`, {\r\n      token: wapi.token,\r\n      seller: seller,\r\n      title,\r\n      price,\r\n      success_url,\r\n      cancel_url\r\n    }).then(response => window.location.href = response.data);\r\n\r\n  wapi.verifySubscription = (seller, title) => axios\r\n    .patch(`${wapi.defaultAPIProtocol}//${wapi.readToken().provider}/dev_pay`, {\r\n      token: wapi.token,\r\n      seller,\r\n      title,\r\n      price: null,\r\n    });\r\n\r\n  wapi.cancelSubscription = (seller, title) => axios\r\n    .delete(`${wapi.defaultAPIProtocol}//${wapi.readToken().provider}/dev_pay`, {\r\n      data: { token: wapi.token, seller, title, }\r\n    });\r\n\r\n  //register the app\r\n  axios.post('https://api.web10.app/register_app', { \"url\": window.location.href.split('?')[0] })\r\n\r\n  //output the wapi object\r\n  return wapi;\r\n}\r\n\r\n//browserify window access\r\nwindow.wapiInit = wapiInit;\r\nwindow.wapiAuthInit = wapiAuthInit;\r\nexport {wapiInit,wapiAuthInit};"],"names":["wapiAuthInit","wapi","wapiAuth","mintOAuthToken","referrerURL","URL","document","referrer","getTieredToken","hostname","readToken","provider","then","response","oAuthToken","data","token","isSignedIn","sendToken","window","opener","postMessage","type","close","logIn","username","password","setAuth","setStatus","axios","post","defaultAPIProtocol","site","location","target","setToken","error","detail","signUp","betacode","phone","SMRListen","setState","addEventListener","e","api","changePass","pass","newPass","new_pass","changePhone","newPhone","console","log","sendCode","verifyCode","code","query","manageSpace","manageCredits","manageBusiness","manageSubscriptions","businessLogin","getPlan","cookieDict","cookie","split","reduce","res","c","trim","map","decodeURIComponent","key","val","Object","assign","JSON","parse","wapiInit","authUrl","rtcOrigin","protocol","childWindow","age","scrubToken","openAuthPortal","open","signOut","authListen","atob","read","service","_W10CRUD","patch","create","update","put","url","HTTPRequestFunction","SMROnReady","sirs","scrs","SMRResponseListen","status","peer","peerID","user","origin","label","replaceAll","inBound","initP2P","onInbound","secure","id","Peer","host","port","path","on","conn","outBound","P2P","connect","send","connected","checkout","seller","title","price","success_url","cancel_url","href","verifySubscription","cancelSubscription"],"mappings":"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"}